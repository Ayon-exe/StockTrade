<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>StockTrade</title>
    <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>
    <script src="script.js" defer></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <!-- Navbar content -->
</nav>

<!-- Marquee -->
<marquee>
    <!-- Marquee content -->
</marquee>

<!-- Account Button -->
<a href="./account.html">
    <button id="account" class="btn btn-default" style="float: right;">Account</button>
</a>

<h1>Stock Prices</h1>
<p id="AAPLstockPrice"></p>
<p id="GOOGLstockPrice"></p>
<p id="AMZNstockPrice"></p>
<p id="MSFTstockPrice"></p>

<div id="chartContainer" style="width:100%; height:280px"></div>

<label>wallet</label> <input id="wallet" type="text" value="0">
<br>
<button onclick="generate()">Generate price</button>  
<label>Current price</label> <input id="currprice" type="text" value="0" readonly>
<br><br>
<button id="buyplus" class="btn btn-default" onclick="buyplus()">+</button> 
<input id="buyamount" size="4" value="1"> 
<button id="buyminus" class="btn btn-default" onclick="buyminus()">-</button> 
<button id="buy" onclick="buy()">buy</button> 
<br><br>
<button id="sellplus" class="btn btn-default" onclick="sellplus()">+</button> 
<input id="sellamount" size="4" value="1"> 
<button id="sellminus" class="btn btn-default" onclick="sellminus()">-</button> 
<button id="sell" onclick="sell()">sell</button>

<script type="text/javascript">
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyD4wlA68qZp41M_CfUf1j93oYn41CoN5eo",
        authDomain: "stocktrade-173c8.firebaseapp.com",
        databaseURL: "https://stocktrade-173c8-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "stocktrade-173c8",
        storageBucket: "stocktrade-173c8.appspot.com",
        messagingSenderId: "58004670302",
        appId: "1:58004670302:web:e942b65ba9ccdaec9d71cf",
        measurementId: "G-BJTP6ZD69S"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    window.onload = function () {
        // Fetch the user's data from Firebase and display the wallet value
        const user = auth.currentUser;
        if (user) {
            const userRef = database.ref('users/' + user.uid);
            
            // Listen for changes in the user's data
            userRef.on('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    document.getElementById('wallet').value = userData.wallet;
                }
            });
        }

        var chart = new CanvasJS.Chart("chartContainer", {
            title: {},
            data: [{
                type: "spline",
                dataPoints: []
            }]
        });
        chart.render();

        $("#buy").click(function () {
            var length = chart.options.data[0].dataPoints.length;
            var gen = parseInt(document.getElementById("currprice").value);
            chart.options.data[0].dataPoints.push({ y: gen });
            chart.render();
        });

        $("#sell").click(function () {
            var length = chart.options.data[0].dataPoints.length;
            var gen = parseInt(document.getElementById("currprice").value);
            chart.options.data[0].dataPoints.push({ y: gen });
            chart.render();
        });
    }

    function generate() {
        document.getElementById("currprice").value = (Math.random() * 100).toFixed(2);
        document.getElementById("hidden").value = document.getElementById("currprice").value;
    }

    function buy() {
        document.getElementById("wallet").value = ((document.getElementById("wallet").value) - ((document.getElementById("currprice").value) * parseFloat(document.getElementById("buyamount").value)));
        generate();
    }

    function sell() {
        (document.getElementById("wallet").value) = (parseFloat(document.getElementById("wallet").value) + (parseFloat(document.getElementById("currprice").value) * parseFloat(document.getElementById("sellamount").value)));
        generate();
    }

    function buyplus() {
        (document.getElementById("buyamount").value) = (parseInt(document.getElementById("buyamount").value)) + 1;
    }

    function buyminus() {
        (document.getElementById("buyamount").value) = (parseInt(document.getElementById("buyamount").value)) - 1;
    }

    function sellplus() {
        (document.getElementById("sellamount").value) = (parseInt(document.getElementById("sellamount").value)) + 1;
    }

    function sellminus() {
        (document.getElementById("sellamount").value) = (parseInt(document.getElementById("sellamount").value)) - 1;
    }
</script>

<div class="tradingview-widget-container">  
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
    {
        "width": "100%",
        "height": "610",
        "symbol": "NASDAQ:AAPL",
        "interval": "D",
        "timezone": "Asia/Kolkata",
        "theme": "light",
        "style": "2",
        "locale": "in",
        "enable_publishing": false,
        "withdateranges": true,
        "allow_symbol_change": true,
        "watchlist": [
            "NASDAQ:GOOGL",
            "NASDAQ:AMZN",
            "NASDAQ:MSFT"
        ],
        "details": true,
        "calendar": false,
        "support_host": "https://www.tradingview.com"
    }
    </script>
</div>

</body>
</html>
